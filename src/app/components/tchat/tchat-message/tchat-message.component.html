<div *ngIf="auth.user$ | async as user">
  <!-- Chat Header -->
  <header class="bg-white p-4 text-gray-700 dark:border-t dark:border-orange-900 dark:bg-gray-800 dark:text-white">
    <a *ngIf="!isAssociation && selectedConversation" [routerLink]="'/associations/'+selectedConversation!.id" class="hover:text-orange-800">
      <h1 class="text-2xl font-semibold text-center">{{selectedConversation!.nom}}</h1>
    </a>
    <h1 *ngIf="isAssociation && selectedConversation" class="text-2xl font-semibold text-center">{{selectedConversation!.nom}}</h1>
  </header>

  <!-- Chat Messages -->
  <div class="h-screen overflow-y-auto p-4 pb-36 bg-gray-100 dark:bg-gray-700">
    <div *ngIf="messages && messages.length > 0; else noMessages">
      <div *ngFor="let msg of messages">
        <!-- Receveur -->
        <div *ngIf="!msg.isUserSender && !isAssociation || msg.isUserSender && isAssociation" class="flex mb-4 cursor-pointer">
          <div class="w-9 h-9 rounded-full flex items-center justify-center mr-2">
            <img alt="..." [src]="selectedConversation?.img || selectedConversation!.photos![0].url" class="w-8 h-8 rounded-full">
          </div>
          <div class="flex max-w-96 bg-white rounded-lg p-3 gap-3">
            <p class="text-gray-700">{{ msg.contenu + ' (receveur)' }}</p>
          </div>
        </div>
        <!-- L'envoyeur -->
        <div *ngIf="msg.isUserSender && !isAssociation || !msg.isUserSender && isAssociation" class="flex justify-end mb-4 cursor-pointer">
          <div class="flex max-w-96 bg-orange-600 text-white rounded-lg p-3 gap-3">
            <p>{{ msg.contenu + ' (envoyeur)' }}</p>
          </div>
          <div class="w-9 h-9 rounded-full flex items-center justify-center ml-2">
            <img *ngIf="isAssociation" alt="..." [src]='user.picture' loading="lazy" decoding="async" referrerpolicy="no-referrer" class="w-8 h-8 rounded-full">
            <img *ngIf="!isAssociation" alt="..." [src]='user.picture' loading="lazy" decoding="async" referrerpolicy="no-referrer" class="w-8 h-8 rounded-full">
          </div>
        </div>
      </div>
    </div>
    <ng-template #noMessages>
      <p class="text-center text-gray-500 dark:text-gray-300">Merci d'Ã©crire votre message</p>
    </ng-template>
  </div>

  <!-- Chat Input -->
  <footer class="bg-white p-4 absolute bottom-0 w-full dark:bg-gray-800">
    <div class="flex items-center">
      <input type="text" [(ngModel)]="message" (keydown.enter)="submit()" placeholder="Tapez un message..." class="w-full p-2 rounded-md border border-gray-400 focus:outline-none focus:border-blue-500">
      <button (click)="submit()" class="bg-orange-600 text-white px-4 py-1 rounded-md ml-2 hover:bg-orange-700">
        <span class="material-symbols-outlined">send</span>
      </button>
    </div>
  </footer>
</div>
